# Cowboystyle

Cowboystyle is a proposed set of tools for maintaining the CSS and Sidebar used
in r/UCSantaBarbara.  

Current Demo/Development Reddits:

* [Temporal](http://www.reddit.com/r/crazysimreddittest)
* [Perma-Day](http://www.reddit.com/r/crazysimreddittesttwo)
* [Perma-Night](http://www.reddit.com/r/crazysimreddittest3)

## Concept

Here are the visual and usability goals of the project that a viewer will
notice:

* Storke Tower is prominently on the right.
  * It is drawn isometrically in pixel art to emphasize it's overall shape
    and color.
  * The tower extends all the way to the bottom.
  * The top of the tower peeks up beyond the subreddit's body like scraping
    the sky.
  * It's a great place to hide an easter egg.
* Strong UCSB colors are used in the header.
* The look of the subreddit changes depending on if the sun is above or
  below the horizon.
  * Colors are adjusted to show that it is night on campus.
  * Images that make up storke tower are swapped for night versions.
  * Users with browsers that support APNG will have a blinking Storke Tower
    that is just like the real thing!  
* Header Reddit Logo text is Retina-display browser friendly.
* Sidebar styling is updated to something a bit more modern.
* Content submit links have been modified to be more prominent.
* Reddit Enhancement Suite elements are taken into consideration for users of
  those extensions to ensure their continued functionality.

## Development Concept

Since there isn't a Ruby on Rails analogue to subreddit styling and sidebar
markdown development for deployment on Heroku, use of some tools and homegrown
scripts were made.  They're definitely not the most polished and will probably
be specific to r/UCSantaBarbara for some time. These scripts will allow
development of the subreddit's style on test subreddits without affecting the
production subreddit.

Ruby tools include:
* Guard for monitoring changes to source files and involing rake tasks
* Rake for task specification
* Compass is used to compile the SCSS files to CSS files

Python tools include:
* deploy.py to handle deployment upon enviromental variables
  * Jinja2 is used in deploy.py to do variable subsitution in the markdown
    files.

Recommended tools to install for development include:
* RVM or rbenv/ruby-build, each with bundler, for running Ruby 1.9.3
* Some form of Virtualenv/pythonz to run virtualenv with Python 2.7.2
* Heroku tools for `foreman` load up `.env` files with private login details
  for easy configuration. It is highly recommended that Heroku tools be
  installed even if you are not deploying to Heroku just for the foreman
  utility.

## Code

Languages used in this project include Ruby, Python, SCSS, Markdown, and
Jinja2. 

Python is used to interact with Reddit and compile the markdown while Ruby is
used for SCSS compilation and development utilities.

## State of the Project

Unfortunately, the Ruby parts are not very clean and the Python parts are
absolutely not Pythonic. It's a start and a good proof of concept though. It
could be put into production at this moment, pending documentation and
approval. However, massive refactoring, particularly in the Python code should
be done before attempts at adding more features are added.


## Git

This project places the SCSS and Sidebar Markdown under `git`. It uses
`git-flow` to manage releases and such. As such, development generally happens
in the `develop` branch. Whatever is in the `master` branch is what goes on
Heroku for the periodically updating CSS.

Even if you don't follow `git-flow`, pull requests are much appreciated.

## Heroku

This framework is designed to be used with heroku. You should be prefixing
commands with `foreman run` with a valid `.env` in order to set proper
enviromental variables.

## CSS

Compilation of this will require a modern ruby and python development setup.
Use `bundler` to install the requirements. Ensure that whatever ruby version
manager you use, use something that is 1.9.3. For Python, it is recommended
that a virtualenv setup be used. The version you should select while creating
the virtualenv for this project should be Python 2.7.x. Install the package
requirements with `pip -r`. 

CSS is is generally generated by Compass. Files in the `sass` folder are
compiled and the resulting CSS files are put into the `styleheets` folder.

You can upload the css files into the test subreddits by editing their
stylesheets manually and pasting in the content from the generated files. This
is stupid and error prone to do constantly so don't do that too often.

Instead, do this because having near instant feedback on whatever you are doing
is extremely valuable:

1. Create two test subreddits and ensure that you have moderator privledges.
   Ensure that the images have been uploaded to both reddits.  See the images
   section for more details on what images must have been uploaded. If the
   images aren't present, the upload will fail.

2. Run `compass compile` to compile the SCSS to CSS.

2. Create a `day.config` and `night.config` file with a template similar to
   this:

    [user]
    username=aredditusername
    password=lol_password
    subreddit=crazysimreddittest
    file=stylesheets/day.css
    mkdn=markdown/sidebar.mkdn

3. Within the project directory, run `python deploy day.config` and `python
   deploy night.config`. Pay attention to the output for any errors.

4. Make sure that the CSS is uploaded. If it isn't you'll see a hacky diff of
   the current CSS and the uploaded CSS. To obtain the actual error message,
   you must upload manually as the current Python API does not respond with
   errors.  Sometimes, it errors out anyway so if your change was very minor or
   there's no way your change can cause that, upload again to make sure.

5. At this point, you have verified that uploading manually works. To compile
   and upload automatically, run `guard`.

## Images

Images must be manually uploaded until the python API allows image uploading.
Only finalized versions are to be put in the images folder. Development of
these images happen in a [Dropbox
folder](https://www.dropbox.com/sh/i3qo9cgdgen1bcf/oNpFhT8gF0).

Images that must be uploaded to the reddit before uploading CSS include:

* Storke Tower
    * Top Night
        * This special image is an APNG with the top light blinking at 40 times
          per minute. Reddit does not allow gifs. It's a minor detail.
    * Top Day
    * Middle Night
    * Middle Day
* Header Background
    * The Alien without the text but the same dimensions as the logo in
      half DPI. This will have seperate night and day versions in the future.
      The framework has been laid out for such already.

_If these images are not uploaded, CSS uploading will fail!_

One more image that doesn't need to be uploaded but is nevertheless important:
    * A 144dpi image of the subreddit text at 280x80. This image will be
      resquashed to the proper dimensions. The reason for the high DPI is to
      ensure that it looks good on Retina-class displays such as the ones on
      newer Macs, iPads, and Android Tablets.

## Sidebar

`sidebar.markdown` is the source for the sidebar. Since the styling may rely on
the ordering of certain elements in the sidebar, the sidebar is placed under
version control as well.

## Guard (Ruby)

A Guardfile has been provided. Run `foreman run guard` to automatically compile
the SCSS and upload to tests reddits set by enviromental variables. It uses the
following enviromental variables which you should set in `.env` for `foreman`
to use:

    REDDIT_SUBREDDIT_DEV_TEMPORAL=crazysimreddittest
    REDDIT_SUBREDDIT_DEV_DAY=crazysimreddittesttwo
    REDDIT_SUBREDDIT_DEV_NIGHT=crazysimreddittest3

## Random Notes

Modded Official logo from http://satedproductions.com/tmp/reddit/alien/
UCSB alien logo and variants from u/snifty.

